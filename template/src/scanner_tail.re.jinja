*/

}

inline {{ prefix | trim('_') }}_scanner_t {{ prefix | trim('_') }}_scanner_from_string(const char *input, size_t len) {
    const unsigned char *s = (const unsigned char *)input;

    {{ prefix | trim('_') }}_scanner_t scanner;
    scanner.src = s;
    scanner.cursor = s;
    scanner.start = s;
    scanner.end = s + len;

    return scanner;
}

void {{ prefix | trim('_') }}_tokenize_add_tokens(token_array *tokens, const char *input, size_t len) {
    {{ prefix | trim('_') }}_scanner_t scanner = {{ prefix | trim('_') }}_scanner_from_string(input, len);

    size_t token_start, token_length;
    uint16_t token_type;

    size_t consumed = 0;

    while (consumed < len) {
        token_type = {{ prefix | trim('_') }}_scan_token(&scanner);

        token_start = scanner.start - scanner.src;
        token_length = scanner.cursor - scanner.start;

        if (token_length == 0) break;

        token_t token;
        token.offset = token_start;
        token.len = token_length;
        token.type = token_type;

        token_array_push(tokens, token);

        consumed += token_length;
    }

}

token_array *{{ prefix | trim('_') }}_tokenize(const char *input) {

    token_array *tokens = token_array_new();

    {{ prefix | trim('_') }}_tokenize_add_tokens(tokens, input, strlen(input));

    return tokens;
}
