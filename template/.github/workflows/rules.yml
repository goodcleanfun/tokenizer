on:
    push:
      branches:
        - main
      paths:
        - 'rules.re'

permissions:
    contents: write
    pull-requests: write

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v3
        - name: Build
          run: |
            sudo apt-get update -y
            sudo apt-get install re2c make bumpversion git libcurl4-gnutls-dev gcc
            git clone https://github.com/clibs/clib.git /tmp/clib && sudo make -C /tmp/clib install
            make -C src clean
            make
            make rules
            git config user.name "Automated"
            git config user.email "actions@users.noreply.github.com"
            git add src/scanner.re src/scanner.c
            timestamp=$(date -u)
            git commit -m "Updated scanner: ${timestamp}" || exit 0
            bumpversion minor
            git push
            git push --tags
  
